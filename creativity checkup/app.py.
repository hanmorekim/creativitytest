import streamlit as st
import pandas as pd
import plotly.express as px

# 페이지 설정
st.set_page_config(page_title="창의성 6요소 자가 진단", page_icon="💡", layout="centered")

# 30개 문항 정의
questions = {
    1: "주위의 미묘한 변화를 잘 알아차린다.",
    2: "어떤 물건을 보고 다른 용도로 쓸 수 없을까 생각한다.",
    3: "남이 하지 않는 생각을 해내려고 노력한다.",
    4: "한 가지 정답보다는 여러 가지 가능성을 생각한다.",
    5: "아이디어가 막힘없이 술술 나오는 편이다.",
    6: "일을 시작하면 끝까지 철저하게 해낸다.",
    7: "호기심이 많아서 이것저것 잘 물어본다.",
    8: "고정관념을 깨는 것을 좋아한다.",
    9: "나만의 독특한 해결 방법을 찾는다.",
    10: "고집을 부리기보다 상황에 따라 생각을 바꾼다.",
    11: "연상되는 단어나 이미지가 풍부하다.",
    12: "엉성한 계획보다 치밀한 계획을 선호한다.",
    13: "분위기나 흐름을 민감하게 파악한다.",
    14: "쓸모없어 보이는 물건도 쓸모 있게 바꾼다.",
    15: "평범한 것보다 파격적인 것을 좋아한다.",
    16: "여러 분야의 지식을 연결해서 생각한다.",
    17: "대화할 때 다양한 화제를 끌어낼 수 있다.",
    18: "하나를 알아도 깊이 있게 파고든다.",
    19: "자연의 변화나 예술 작품에 감동을 잘 받는다.",
    20: "익숙한 것을 낯설게 보려고 시도한다.",
    21: "관습이나 전통에 얽매이지 않는다.",
    22: "이 생각 저 생각으로 옮겨가는 것이 빠르다.",
    23: "문장이나 그림을 풍부하게 표현한다.",
    24: "작은 부분도 소홀히 하지 않고 정성껏 다룬다.",
    25: "언제나 새로운 것을 추구하고 있다.",
    26: "사람들이 못보고 넘어간 곳을 읽어낸다.",
    27: "남과 다른 복장에 신경 안 쓴다.",
    28: "그럴 수도 있다고 늘 생각하는 편이다.",
    29: "상상이든 기존의 지식이든 쉽게 발상을 짐작 전개해 간다.",
    30: "도중에서 타협하지 않는다."
}

# 웹 앱 메인 화면 구성
st.title("💡 창의성 6요소 자가 진단")
st.write("각 문항을 읽고 자신에게 해당되는 정도를 선택해주세요.")
st.caption("1점: 전혀 그렇지 않다 | 5점: 매우 그렇다")

# 점수를 저장할 딕셔너리
scores = {}

# 30개 문항을 반복하며 슬라이더 위젯 생성
with st.form("creativity_survey_form"):
    for i in range(1, 31):
        scores[i] = st.slider(f"Q{i}. {questions[i]}", 1, 5, 3)
    
    # 제출 버튼
    submitted = st.form_submit_button("🎯 진단 결과 보기")

# 결과 분석 및 시각화
if submitted:
    st.markdown("---")
    st.header("📊 나의 창의성 프로필 결과")

    # 요소별 점수 계산 로직
    results = {
        "감수성 (Sensitivity)": scores[1] + scores[7] + scores[13] + scores[19] + scores[25],
        "재정의 (Reidentification)": scores[2] + scores[8] + scores[14] + scores[20] + scores[26],
        "독창성 (Originality)": scores[3] + scores[9] + scores[15] + scores[21] + scores[27],
        "유연성 (Flexibility)": scores[4] + scores[10] + scores[16] + scores[22] + scores[28],
        "유창성 (Fluency)": scores[5] + scores[11] + scores[17] + scores[23] + scores[29],
        "정교성/집중 (Elaboration)": scores[6] + scores[12] + scores[18] + scores[24] + scores[30],
    }

    # 레이더 차트를 위한 데이터프레임 생성
    df = pd.DataFrame(list(results.items()), columns=['Category', 'Score'])
    
    # Plotly 레이더 차트 그리기
    fig = px.line_polar(df, r='Score', theta='Category', line_close=True,
                        range_r=[0, 25], # 점수 범위 설정 (0~25점)
                        title="창의성 6요소 레이더 차트")
    fig.update_traces(fill='toself', line_color='teal') # 스타일 설정
    fig.update_layout(polar=dict(radialaxis=dict(visible=True, tickvals=[5, 10, 15, 20, 25])))

    # 차트 출력
    st.plotly_chart(fig, use_container_width=True)
    
    # 상세 점수표 및 가이드
    st.subheader("📝 세부 점수 및 분석 가이드")
    col1, col2 = st.columns(2)
    for i, (category, score) in enumerate(results.items()):
        if i < 3:
            col1.metric(label=category, value=f"{score}점 / 25점")
        else:
            col2.metric(label=category, value=f"{score}점 / 25점")
            
    st.info("""
    * **가장 높은 점수**: 본인의 창의적 강점입니다. 브랜딩 기획 시 이 부분을 적극 활용하세요.
    * **가장 낮은 점수**: 이번 학기에 의식적으로 개선할 수 있는 포인트입니다. 예를 들어, '정교성'이 낮다면 아이디어를 낸 후 실행 계획을 치밀하게 세우는 연습을 해보세요.
    """)
